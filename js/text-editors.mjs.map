{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;AAaA,MAAM,aAAa;AAEnB,IAAI,UAAU,IAAI,OAAO;AACzB,IAAI,UAAU,IAAI,OAAO;AACzB,IAAI,UAAU,MAAM,OAAO;AAE3B,OAAO,IAAI,OAAO;AAAA,EACjB,GAAG,OAAO,IAAI;AACf;AAEA,MAAM,gBAAgB;AAAA,EAIrB,YAAY,IAAI,MAAM;AAJvB;AAEC;AACA;AAEC,uBAAK,KAAM;AACX,uBAAK,OAAQ;AACb,0BAAK,8CAAL;AACA,WAAO;AAAA,EACP;AAAA,EAMD,SAAS,mBAAmB,MAAM;AAAA,KAAI;AACrC,uBAAK,KAAI,IAAI,kBAAkB,CAAC,YAAY;AAC3C,uBAAiB,OAAO;AAAA,IAC3B,CAAG;AACD,WAAO;AAAA,EACP;AAAA,EAED,SAAS,mBAAmB,MAAM;AAAA,KAAI;AACrC,uBAAK,KAAI,IAAI,SAAS,MAAM;AAC3B,uBAAkB;AAAA,IACrB,CAAG;AACD,WAAO;AAAA,EACP;AAAA,EAED,SAAS,mBAAmB,MAAM;AAAA,KAAI;AACrC,uBAAK,KAAI,IAAI,kBAAkB,CAAC,YAAY;AAC3C,uBAAiB,OAAO;AAAA,IAC3B,CAAG;AACD,WAAO;AAAA,EACP;AAAA,EAED,gBAAgB,0BAA0B,MAAM;AAAA,KAAI;AACnD,uBAAK,KAAI,IAAI,mBAAmB,CAAC,YAAY;AAC5C,8BAAwB,OAAO;AAAA,IAClC,CAAG;AACD,WAAO;AAAA,EACP;AAAA,EAED,SAAS,mBAAmB,MAAM;AAAA,KAAI;AACpC,cAAU,8BAA8B,gBAAgB;AACxD,WAAO;AAAA,EACR;AAAA,EAED,OAAO,IAAI;AACV,OAAG,YAAY;AACf,UAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,OAAG,YAAY,OAAO;AACtB,uBAAK,KAAI,OAAO,OAAO;AACvB,WAAO;AAAA,EACP;AAAA,EAED,UAAU;AACT,uBAAK,KAAI,SAAU;AACnB,uBAAK,KAAI,IAAI,YAAY;AAAA,EACzB;AAAA,EAED,WAAW,SAAS;;AAEnB,uBAAK,KAAI,KAAK,mBAAK,QAAO,WAAW,OAAO;AAE5C,sCAAK,mDAAL,kCAA4B,eAA5B,4BAAyC;AACzC,WAAO;AAAA,EACP;AAAA,EAED,eAAe,OAAO,UAAU;;AAC/B,UAAM,UAAS,2BAAK,mDAAL,kCAA4B;AAC3C,WAAO,SAAS,eAAe,OAAO,QAAQ;AAAA,EAC9C;AAAA,EAED,aAAa;;AACZ,UAAM,UAAS,2BAAK,mDAAL,kCAA4B;AAC3C,WAAO,SAAS,UAAW;AAAA,EAC3B;AAAA,EAED,iBAAiB;;AAChB,UAAM,UAAS,2BAAK,mDAAL,kCAA4B;AAC3C,WAAO,SAAS,cAAe;AAAA,EAC/B;AAAA,EAED,MAAM,OAAO;;AACZ,YAAO,iCAAK,mDAAL,YAA2B,SAA3B;AAAA,EACP;AAAA,EAED,eAAe,OAAO;AACrB,uBAAK,KAAI,KAAK,mBAAK,QAAO,sBAAsB,KAAK;AACrD,WAAO;AAAA,EACP;AAAA,EAED,YAAY,OAAO;AAClB,uBAAK,KAAI,KAAK,mBAAK,QAAO,YAAY,KAAK;AAC3C,WAAO;AAAA,EACP;AAAA,EAED,eAAe,SAAS;AACvB,0BAAK,mDAAL,WAA2B,QAAQ,MAAK,EAAG,cAAc,OAAO,EAAE,MAAO,EAAC,IAAK;AAAA,EAC/E;AAAA,EAED,QAAQ;AACP,0BAAK,mDAAL,WAA2B,QAAQ,SAAS,MAAO;AAAA,EACnD;AAYF;AAlHC;AACA;AAHD;AAWC,wBAAmB,WAAG;AACrB,SAAO,mBAAK,KAAI,UAAU,CAAC;AAC3B;AA6FD,mBAAc,WAAG;;AAChB,MAAI,iCAAQ,WAAW;AACtB,SAAK,KAAK,mBAAK;AACf,WAAO,IAAI,KAAK,SAAS;AAAA,MACxB,IAAI,YAAO,IAAI,KAAK,WAAhB,YAA0B;AAAA,MAC9B;AAAA,IACA;AAAA,EACD;AACD;AAIF,OAAO,IAAI,KAAK,aAAa;AAC7B,OAAO,IAAI,KAAK,eAAe,eAAe;AAAA;AAAA,EAE7C;AAAA;AAAA;AAAA,EAIA,SAAS;AAAA,EACT,aAAa;AAAA,EACb,WAAW;AAAA,EACX,aAAa;AAAA,EAEb,UAAU;AAAA,EAEV,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,cAAc;AAAA,IACb,WAAW;AAAA,IACX,OAAO;AAAA,EACP;AAAA,EAED,WAAW,CAAC,EAAE,SAAQ,MAAO;AAAA,EAAE;AAAA,EAC/B,WAAW,MAAM;AAAA,EAAE;AAAA,EACnB,WAAW,CAAC,EAAE,SAAQ,MAAO;AAAA,EAAE;AAAA,EAC/B,kBAAkB,CAAC,YAAY;AAAA,EAAE;AAAA,EACjC,eAAe;AAAA,EACf,kBAAkB;AAAA,EAClB,kBAAkB;AAAA,EAClB,WAAW;AACZ,GAAG;AACF,QAAM,EAAE,SAAS,sBAAuB,IAAG;sDAAM;AAAA;AAAA,MAAuC;AAAA,IAA+C;AAAC,sBAAAA,uBAAA;AAAA;AACxI,QAAM,EAAE,SAAS,OAAQ,IAAG,MAAM;AAAA,qBAAAC,QAAA;AAAA;AAAA,MAAuC;AAAA,IAAyB;AAAC,sBAAAA,QAAA;AAAA;AAEnG,QAAM,OAAO,IAAI,WAAW;AAAA,IAC3B,oBAAoB;AAAA,IACpB;AAAA,IACA;AAAA,EACF,CAAE;AAED,QAAM,gBAAgB,UAAU;AAEhC,QAAM,KAAK,IAAI,IAAI;AAAA,IAClB,UAAU;AACT,aAAO;AAAA,QACN,CAAC,wBAAwB,GAAG;AAAA,QAC5B,CAAC,aAAa,GAAG,CAAC,CAAC;AAAA,QACnB,CAAC,mBAAmB,GAAG,gBAAgB,OAAO;AAAA,QAC9C,CAAC,mBAAmB,GAAG,gBAAgB,OAAO;AAAA,QAC9C,CAAC,mBAAmB,GAAG;AAAA,UACtB,QAAQ,KAAK,WAAW;AACvB,mBAAO,CAAC;AAAA,cACP,MAAM;AAAA,cACN,KAAK;AAAA,YACZ,CAAO;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,IACD,OAAO;AACN,aAAO;AAAA,IACP;AAAA,IACD,QAAQ,OAAK;AACZ,YAAM,eAAc,2CAAa,aAC9B;AAAA,QACD,aAAa,MAAM;AAClB,iBAAO,EAAE,YAAY,WAAW;AAAA,YAC/B,OAAO,YAAY;AAAA,UAC1B,CAAO;AAAA,QACD;AAAA,MACD,IACC,CAAE;AAEL,aAAO,gBACJ,EAAE,QAAQ;AAAA,QACX,OAAO;AAAA,UACN;AAAA,UACA,cAAc;AAAA,UACd;AAAA,UACA,MAAM;AAAA,UACN,QAAQ;AAAA,UACR;AAAA,UACA,oBAAoB,KAAK;AAAA,QACzB;AAAA,QACD;AAAA,MACL,CAAK,IACC,EAAE,uBAAuB;AAAA,QAC1B,OAAO;AAAA,UACN;AAAA,UACA,SAAS,KAAK;AAAA,UACd,cAAc;AAAA,UACd;AAAA,UACA,UAAU,KAAK;AAAA,UACf,oBAAoB,KAAK;AAAA,QACzB;AAAA,QACD;AAAA,MACL,CAAK;AAAA,IACF;AAAA,IACD;AAAA,EACF,CAAE;AACD,SAAO,IAAI,gBAAgB,IAAI,IAAI,EACjC,SAAS,QAAQ,EACjB,SAAS,QAAQ,EACjB,SAAS,QAAQ,EACjB,gBAAgB,eAAe,EAC/B,SAAS,QAAQ,EACjB,OAAO,EAAE;AACZ","names":["MarkdownContentEditor","Editor"],"ignoreList":[],"sources":["../src/editor.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\nimport store from './store/index.js'\nimport { subscribe } from '@nextcloud/event-bus'\nimport { EDITOR_UPLOAD, HOOK_MENTION_SEARCH, HOOK_MENTION_INSERT, ATTACHMENT_RESOLVER } from './components/Editor.provider.js'\nimport { ACTION_ATTACHMENT_PROMPT } from './components/Editor/MediaHandler.provider.js'\n// eslint-disable-next-line import/no-unresolved, n/no-missing-import\nimport 'vite/modulepreload-polyfill'\n\nconst apiVersion = '1.1'\n\nVue.prototype.t = window.t\nVue.prototype.n = window.n\nVue.prototype.OCA = window.OCA\n\nwindow.OCA.Text = {\n\t...window.OCA.Text,\n}\n\nclass TextEditorEmbed {\n\n\t#vm\n\t#data\n\tconstructor(vm, data) {\n\t\tthis.#vm = vm\n\t\tthis.#data = data\n\t\tthis.#registerDebug()\n\t\treturn this\n\t}\n\n\t#getEditorComponent() {\n\t\treturn this.#vm.$children[0]\n\t}\n\n\tonCreate(onCreateCallback = () => {}) {\n\t\tthis.#vm.$on('create:content', (content) => {\n\t\t\tonCreateCallback(content)\n\t\t})\n\t\treturn this\n\t}\n\n\tonLoaded(onLoadedCallback = () => {}) {\n\t\tthis.#vm.$on('ready', () => {\n\t\t\tonLoadedCallback()\n\t\t})\n\t\treturn this\n\t}\n\n\tonUpdate(onUpdateCallback = () => {}) {\n\t\tthis.#vm.$on('update:content', (content) => {\n\t\t\tonUpdateCallback(content)\n\t\t})\n\t\treturn this\n\t}\n\n\tonOutlineToggle(onOutlineToggleCallback = () => {}) {\n\t\tthis.#vm.$on('outline-toggled', (visible) => {\n\t\t\tonOutlineToggleCallback(visible)\n\t\t})\n\t\treturn this\n\t}\n\n\tonSearch(onSearchCallback = () => {}) {\n\t  subscribe('text:editor:search-results', onSearchCallback)\n\t  return this\n\t}\n\n\trender(el) {\n\t\tel.innerHTML = ''\n\t\tconst element = document.createElement('div')\n\t\tel.appendChild(element)\n\t\tthis.#vm.$mount(element)\n\t\treturn this\n\t}\n\n\tdestroy() {\n\t\tthis.#vm.$destroy()\n\t\tthis.#vm.$el.innerHTML = ''\n\t}\n\n\tsetContent(content) {\n\t\t// Update reactive prop for MarkdownContentEditor\n\t\tthis.#vm.$set(this.#data, 'content', content)\n\t\t// Call setContent for file based Editor\n\t\tthis.#getEditorComponent()?.setContent?.(content)\n\t\treturn this\n\t}\n\n\tsetSearchQuery(query, matchAll) {\n\t\tconst editor = this.#getEditorComponent()?.$editor\n\t\teditor.commands.setSearchQuery(query, matchAll)\n\t}\n\n\tsearchNext() {\n\t\tconst editor = this.#getEditorComponent()?.$editor\n\t\teditor.commands.nextMatch()\n\t}\n\n\tsearchPrevious() {\n\t\tconst editor = this.#getEditorComponent()?.$editor\n\t\teditor.commands.previousMatch()\n\t}\n\n\tasync save() {\n\t\treturn this.#getEditorComponent().save?.()\n\t}\n\n\tsetShowOutline(value) {\n\t\tthis.#vm.$set(this.#data, 'showOutlineOutside', value)\n\t\treturn this\n\t}\n\n\tsetReadOnly(value) {\n\t\tthis.#vm.$set(this.#data, 'readOnly', value)\n\t\treturn this\n\t}\n\n\tinsertAtCursor(content) {\n\t\tthis.#getEditorComponent().$editor.chain().insertContent(content).focus().run()\n\t}\n\n\tfocus() {\n\t\tthis.#getEditorComponent().$editor.commands.focus()\n\t}\n\n\t#registerDebug() {\n\t\tif (window?._oc_debug) {\n\t\t\tthis.vm = this.#vm\n\t\t\twindow.OCA.Text._debug = [\n\t\t\t\t...(window.OCA.Text._debug ?? []),\n\t\t\t\tthis,\n\t\t\t]\n\t\t}\n\t}\n\n}\n\nwindow.OCA.Text.apiVersion = apiVersion\nwindow.OCA.Text.createEditor = async function({\n\t// Element to render the editor to\n\tel,\n\n\t// Session editor with file mode is enabled by setting the fileId and useSession.\n\t// Otherwise, content needs to be provided.\n\tfileId = undefined,\n\tuseSession = true,\n\tfilePath = undefined,\n\tshareToken = null,\n\n\tcontent = '',\n\n\treadOnly = false,\n\tautofocus = true,\n\treadonlyBar = {\n\t\tcomponent: null,\n\t\tprops: null,\n\t},\n\n\tonCreate = ({ markdown }) => {},\n\tonLoaded = () => {},\n\tonUpdate = ({ markdown }) => {},\n\tonOutlineToggle = (visible) => {},\n\tonFileInsert = undefined,\n\tonMentionSearch = undefined,\n\tonMentionInsert = undefined,\n\tonSearch = undefined,\n}) {\n\tconst { default: MarkdownContentEditor } = await import(/* webpackChunkName: \"editor\" */'./components/Editor/MarkdownContentEditor.vue')\n\tconst { default: Editor } = await import(/* webpackChunkName: \"editor\" */'./components/Editor.vue')\n\n\tconst data = Vue.observable({\n\t\tshowOutlineOutside: false,\n\t\treadOnly,\n\t\tcontent,\n\t})\n\n\tconst sessionEditor = fileId && useSession\n\n\tconst vm = new Vue({\n\t\tprovide() {\n\t\t\treturn {\n\t\t\t\t[ACTION_ATTACHMENT_PROMPT]: onFileInsert,\n\t\t\t\t[EDITOR_UPLOAD]: !!sessionEditor,\n\t\t\t\t[HOOK_MENTION_SEARCH]: sessionEditor ? true : onMentionSearch,\n\t\t\t\t[HOOK_MENTION_INSERT]: sessionEditor ? true : onMentionInsert,\n\t\t\t\t[ATTACHMENT_RESOLVER]: {\n\t\t\t\t\tresolve(src, preferRaw) {\n\t\t\t\t\t\treturn [{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: src,\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn data\n\t\t},\n\t\trender: h => {\n\t\t\tconst scopedSlots = readonlyBar?.component\n\t\t\t\t? {\n\t\t\t\t\treadonlyBar: () => {\n\t\t\t\t\t\treturn h(readonlyBar.component, {\n\t\t\t\t\t\t\tprops: readonlyBar.props,\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t\t: {}\n\n\t\t\treturn sessionEditor\n\t\t\t\t? h(Editor, {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tfileId,\n\t\t\t\t\t\trelativePath: filePath,\n\t\t\t\t\t\tshareToken,\n\t\t\t\t\t\tmime: 'text/markdown',\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tautofocus,\n\t\t\t\t\t\tshowOutlineOutside: data.showOutlineOutside,\n\t\t\t\t\t},\n\t\t\t\t\tscopedSlots,\n\t\t\t\t})\n\t\t\t\t: h(MarkdownContentEditor, {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tfileId,\n\t\t\t\t\t\tcontent: data.content,\n\t\t\t\t\t\trelativePath: filePath,\n\t\t\t\t\t\tshareToken,\n\t\t\t\t\t\treadOnly: data.readOnly,\n\t\t\t\t\t\tshowOutlineOutside: data.showOutlineOutside,\n\t\t\t\t\t},\n\t\t\t\t\tscopedSlots,\n\t\t\t\t})\n\t\t},\n\t\tstore,\n\t})\n\treturn new TextEditorEmbed(vm, data)\n\t\t.onCreate(onCreate)\n\t\t.onLoaded(onLoaded)\n\t\t.onUpdate(onUpdate)\n\t\t.onOutlineToggle(onOutlineToggle)\n\t\t.onSearch(onSearch)\n\t\t.render(el)\n}\n"],"file":"js/text-editors.mjs"}